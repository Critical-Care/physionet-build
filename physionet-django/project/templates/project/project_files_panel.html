{% load static %}

<div id="forms-and-panel">
  <form action="" method="post" type="submit" enctype="multipart/form-data">
    {% csrf_token %}
    {% include "project/project_files_form.html" %}
    <br>

    <div id="files-panel" class="card">
      <div class="card-header">
        <div class="row">
          <div class="col-md-8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Folder Navigation:
          {% for breadcrumb in dir_breadcrumbs %}
            {% if forloop.counter == dir_breadcrumbs|length %}
              {{ breadcrumb.name }}
            {% else %}
              <a href="" onclick="return navigateDir('{{ breadcrumb.full_subdir }}')">{{ breadcrumb.name }}</a>&nbsp;/&nbsp;
            {% endif %}
          {% endfor %}
          </div>
        </div>
      </div>
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
          <div class="row">
            <div class="col-md-7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Name</strong></div>
            <div class="col-md-2"><strong>Size</strong></div>
            <div class="col-md-2"><strong>Modified</strong></div>
            <div class="col-md-1"></div>
          </div>
        </li>
        {% if subdir %}
          <li class="list-group-item">
            <div class="row">
              <div class="col-md-7">&nbsp;<i class="fas fa-angle-up"></i>&nbsp;&nbsp;<a href="" onclick="return navigateDir('{{ parent_dir }}')">Parent Directory</a></div>
              <div class="col-md-2"></div>
              <div class="col-md-2"></div>
              <div class="col-md-1"></div>
            </div>
          </li>
        {% endif %}
        {% for dir in display_dirs %}
          <li class="list-group-item">
            <div class="row">
              <div class="col-md-7"><i class="fas fa-folder-open"></i>&nbsp;&nbsp;<a href="" onclick="return navigateDir('{{ dir.full_subdir }}')">{{ dir.name }}</a></div>
              <div class="col-md-2"></div>
              <div class="col-md-2"></div>
              <div class="col-md-1"><input type="checkbox" name="items" value="{{ dir.name }}" onchange="countSelected(this)"></div>
            </div>
          </li>
        {% endfor %}
        {% for file in display_files %}
          <li class="list-group-item">
            <div class="row">
              <div class="col-md-7">&nbsp;<i class="far fa-file"></i>&nbsp;&nbsp;&nbsp;<a href="{% url 'serve_project_file' project.id file.full_file_name %}">{{ file.name }}</a></div>
              <div class="col-md-2">{{ file.size }}</div>
              <div class="col-md-2">{{ file.last_modified }}</div>
              <div class="col-md-1"><input type="checkbox" name="items" value="{{ file.name }}" onchange="countSelected(this)"></div>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
  </form>

</div>
<script>
  // Navigate to another file directory and reload the file panel
  // subdir is the full subdirectory
  function navigateDir(subdir){
    var csrftoken = getCookie('csrftoken');
    $.ajax({
            type: "GET",
            url: "{% url 'project_files_panel' project.id %}",
            data: {'csrfmiddlewaretoken':csrftoken, 'subdir':subdir
            },
            success: function reloadSection(result){
                $("#forms-and-panel").html(result);
            },
    });
    return false
  }


  // Selected checkboxes
  n_selected = 0

  // Enables and disables buttons based on selected checkboxes
  function countSelected(box){
    if (box.checked){
      n_selected ++
    }
    else{
      n_selected --
    }

    if (n_selected > 0){
      if (n_selected == 1){
        document.getElementById("rename-item-button").disabled = false
      }
      else{
        document.getElementById("rename-item-button").disabled = true
      }
      document.getElementById("move-items-button").disabled = false
      document.getElementById("delete-items-button").disabled = false
    }
    else{
      document.getElementById("rename-item-button").disabled = true
      document.getElementById("move-items-button").disabled = true
      document.getElementById("delete-items-button").disabled = true
    }
  }

  // Get the names of all the selected items
function getSelected(){
  var itemNames = []
  var items = document.querySelectorAll('input[type="checkbox"]:checked')

  for (i=0; i<items.length; i++){
    itemNames.push(items[i].value)
  }

  // itemNames = [{"name":"hi", "value":"LOL"}]
//   [
//   {
//     name: "a",
//     value: "1"
//   },
//   {
//     name: "b",
//     value: "2"
//   },
//   {
//     name: "c",
//     value: "3"
//   },
//   {
//     name: "d",
//     value: "4"
//   },
//   {
//     name: "e",
//     value: "5"
//   }
// ]


  return itemNames
}


  // Fill in the rename modal
  function prepareRename(){
    // alert(document.querySelectorAll('input[type="checkbox"]:checked').length);
    var itemName = document.querySelector('input[type="checkbox"]:checked').value
    document.getElementById("rename-item-message").innerHTML = "Selected item: <strong>"+ itemName + "</strong>"

  }

  function prepareMove(){
    document.getElementById("move-items-message").innerHTML = "Move "+ n_selected + " selected item(s) into destination folder."
  }

  function prepareDelete(){
    document.getElementById("delete-items-message").innerHTML = "Are you sure you wish to delete the "+ n_selected + " selected item(s)?"
  }

   $('#delete-items-form').submit(function(eventObj) {
        $(this).append('<input type="hidden" name="selected_items" value=["hi","bye"] /> ');
        return true;
    });
</script>


