{% extends "project/project.html" %}

{% load project_templatetags %}

{% block title %}Project Authors{% endblock %}

{% block form %}
<h2 class="form-signin-heading">Project Authors</h2>
<hr>

<p>Each project has one or more <strong>authors</strong>, including the single <strong>submitting author</strong> who creates the project. Authors are credited for creating the resource when it is published.</p>

<p>An author may be a person, or an organization. Human authors must be invited and accept authorship, and fill in their own details. Only the submitting author may invite authors, add organizational authors, remove authors, and change the final author display order.</p>

<hr>

<div class="card">
  <div class="card card-header">
    <h4>Project Authors</h4>
  </div>
  {% if authors %}
    <ul class="list-group list-group-flush">
      {% for author in authors %}
        <li class="list-group-item">
          {% if author.is_human %}
            <strong>User</strong>: {{ author.user }}
            {% if author == project.submitting_author %}
              <a class="float-right">
              </a>
            {% endif %}
            <br>
            <strong>Name</strong>: {{ author|author_name }}<br>
            <strong>Affiliations</strong>: {{ author|author_affiliations }}
          {% else %}
            <strong>Organization</strong>: {{ author.organization_name }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="card card-body text-center">
    </div>
  {% endif %}
</div>
<hr>

<h4>Your Author Information</h4>
<p>Edit your author information. <em>Note: these fields are not tied to your user profile</em>.</p>
<form action="{% url 'project_authors' project.id %}" method="post" class="form-signin">
  {% csrf_token %}
  {% include "form_snippet.html" with form=edit_author_form %}
  <button class="btn btn-primary btn-fixed" name="edit_author" type="submit">Set Information</button>
</form>
<hr>

<h4>Your Author Affiliations</h4>
<p>Set up to three affiliations for your author profile. <em>Note: these fields are not tied to your user profile</em>.</p>
<form action="{% url 'project_authors' project.id %}" method="post" class="form-signin">
  {% csrf_token %}
  {{ affiliation_formset }}
  <button class="btn btn-primary btn-fixed" name="edit_affiliations" type="submit">Set Affiliations</button>
</form>
<hr>

<div class="card">
  <div class="card card-header">
    <h4>Outstanding Author Invitations</h4>
  </div>
  <ul class="list-group list-group-flush">
    {% if invitations %}
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
          <div class="row">
            <div class="col-md-4"><strong>Invitee</strong></div>
            <div class="col-md-4"><strong>Inviter</strong></div>
            <div class="col-md-2"><strong>Sent</strong></div>
            <div class="col-md-2"><strong>Expires</strong></div>
          </div>
        </li>
        {% for invitation in invitations %}
          <li class="list-group-item">
            <div class="row">
              <div class="col-md-4">{{ invitation.email }}</a></div>
              <div class="col-md-4">{{ invitation.inviter }}</div>
              <div class="col-md-2">{{ invitation.creation_date }}</div>
              <div class="col-md-2">{{ invitation.expiration_date }}</div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="card-body text-center">
      </div>
    {% endif %}
  </ul>
</div>
<hr>

{% if user == project.submitting_author or user.is_admin %}
    <h4>Order Authors</h4>
    <p>Set the order in which authors are displayed</p>
    <form action="{% url 'project_authors' project.id %}" method="post" class="form-signin">
      {% csrf_token %}
      {{ order_formset }}
      <button class="btn btn-primary btn-fixed" name="order_authors" type="submit">Order Authors</button>
    </form>
    <hr>

    <h4>Invite Author</h4>
    <p>Invite an author with their email</p>
    <form action="{% url 'project_authors' project.id %}" method="post" class="form-signin">
      {% csrf_token %}
      {% include "form_snippet.html" with form=invite_author_form %}
      <button class="btn btn-success btn-fixed" name="invite_author" type="submit">Invite Author</button>
    </form>
    <hr>

    <h4>Add Organizational Author</h4>
    <p>Add an organizational author.</p>
    <form action="{% url 'project_authors' project.id %}" method="post" class="form-signin">
      {% csrf_token %}
      {% include "form_snippet.html" with form=add_author_form %}
      <button class="btn btn-success btn-fixed" name="add_author" type="submit">Add Author</button>
    </form>
    <hr>

    <h4>Remove Author</h4>
    <p>Remove an author from the project.</p>
    <form action="{% url 'project_authors' project.id %}" method="post" class="form-signin">
      {% csrf_token %}
      {% include "form_snippet_no_labels.html" with form=remove_author_form %}
      <button class="btn btn-danger btn-fixed" name="remove_author" type="submit">Remove Author</button>
    </form>
    <hr>

    <h4>Cancel Invitation</h4>
    <p>Cancel an existing author invitation.</p>
    <form action="{% url 'project_authors' project.id %}" method="post" class="form-signin">
      {% csrf_token %}
      {% include "form_snippet_no_labels.html" with form=cancel_invitation_form %}
      <button class="btn btn-danger btn-fixed" name="cancel_invitation" type="submit">Cancel Invitation</button>
    </form>
    <hr>

    {% endif %}

{% endblock %}
