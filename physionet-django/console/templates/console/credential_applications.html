{% extends "console/base_console.html" %}

{% block title %}Credential Applications{% endblock %}

{% load console_templatetags %}

{% block local_css %}
<style>
tr {
    display: none;
}

tr.header {
    display: table-row;
    cursor: pointer;
}

</style>
{% endblock %}
{% block content %}
<div class="card">
  <div class="card-header">
    Number of credentialed people <span class="badge badge-pill badge-info">{{application_number}}</span>
  </div>

  <div class="card-body">
    <div class="tab-content">
      {# Reference not contacted #}
        {% if application_list %}
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead>
                <tr class="header">
                  <th>#</th>
                  <th>User</th>
                  <th>Full Name</th>
                  <th>Email</th>
                  <th>Application Date</th>
                  <th>Reference Contact Date</th>
                  <th>Reference Verification Date</th>
                </tr>
              </thead>
              <tbody>
              {% for application in application_list %}
                <tr class="header" id='application_{{application.user.email}}'>
                {% with user=application.user %}
                  <td>{{forloop.counter}}</td>
                  <td><a href="{% url 'public_profile' user.username %}">{{ user }}</td>
                  <td>{{ user.get_full_name }}</td>
                  <td>{{ user.email }}</td>
                  <td>{{ application.application_datetime|date }}</td>
                  <td>{{ application.reference_contact_datetime|date }}</td>
                  <td>{{ application.reference_response_datetime|date }}</td>
                {% endwith %}
                </tr>
                  {% include "console/application_display.html" with user=application.user form=process_credential_form %}
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p><i class="fas fa-check" style="color:green"></i> No applications to show.</p>
        {% endif %}
    </div>
  </div>
</div>
{% endblock %}
{% block local_js_bottom %}
<script>
  $('tr.header').click(function(){
    $(this).nextUntil('tr.header').css('display', function(i,v){
        return this.style.display === 'table-row' ? 'none' : 'table-row';
    });
  });
$('#id_reference_contact_content').val()
Dear {{ application.reference_name }},

Your colleague {{ applicant_name }} is applying for credentialed access to PhysioNet, the website for sharing biomedical data. Your name is listed as their reference for the application.

If you support their application for credentialed access, please indicate your approval using the form at: http://{{ domain }}{% url 'credential_reference' application.slug %}. If you do not support their application, please ignore this email or update us directly via the link.

{{ signature }}


</script>
{% endblock %}