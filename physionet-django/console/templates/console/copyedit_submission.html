{% extends "console/base_console.html" %}

{% block title %}Copyedit Submission{% endblock %}

{% block local_js_top %}
<script>
  function copyToClipboard(str){
    var el = document.createElement('textarea');
    el.value = str;
    document.body.appendChild(el);
    el.select();
    document.execCommand('copy');
    document.body.removeChild(el);
  }
</script>
{% endblock %}

{% block content %}

{% include "console/project_info_card.html" %}

<div class="card mb-3">
  <div class="card-header">
    <i class="fas fa-edit"></i> Copyedit Submission
  </div>
  <div class="card-body">
    <p>Make adjustments to the metadata and files. Contact the authors via email to discuss changes, or to indicate that you have finished making changes.</p>
    <p>
      <button class="btn btn-primary" onclick="copyToClipboard('{{ author_emails }}')">Copy Emails to Clipboard</button>
    </p>
    <h4>Author Approval</h4>
    <p>When you and all of the authors approve of the final state of the project, you may complete this step.</p>
    <ol>
    {% for author in authors %}
      <li>
        {% if author.approved_publish %}
          <i class="fas fa-check-circle" style="color:green"></i> {{ author.disp_name_email }}
        {% else %}
          <i class="far fa-clock"></i> {{ author.disp_name_email }}
        {% endif %}
      </li>
    {% endfor %}
    </ol>
    <button class="btn btn-success btn-lg" data-toggle="modal" data-target="#complete-modal" {% if not authors_approved %}disabled{% endif %}>Complete Copyedit</a>
  </div>
</div>

{% if authors_approved %}
<div class="modal" id="complete-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Complete Copyedit</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>If you are satisfied with project's files and metadata, you may complete the copyedit. You will no longer be able to edit the project.</p>
      </div>
      <div class="modal-footer">
        <form action="" method="post">
          {% csrf_token %}
          <button class="btn btn-success" name="complete_copyedit" type="submit">Complete Copyedit</button>
        </form>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% endif %}


{% endblock %}
