{% extends "console/base_console.html" %}

{% load static %}

{% block title %}PhysioNet Users{% endblock %}

{% block local_css %}
<link rel="stylesheet" type="text/css" href="{% static 'search/css/content-index.css' %}">
{% endblock %}

{% block content %}
{% url 'user_list_inactive' as user_list_inactive %}
<script src="{% static 'custom/js/cookie.js' %}"></script>
<script src="{% static 'project/js/dynamic-formset.js' %}"></script>
<script type="text/javascript">
 function search(value){
  var csrftoken = getCookie('csrftoken');
  $.ajax({
    type: "POST",
    url: "{% url 'users_list_search' %}",
    data: {'csrfmiddlewaretoken':csrftoken,
            'search_field':value,
            {% if request.path == user_list_inactive %}
              'inactive':true,
            {% endif %}
    },
    success: function reloadSection(result){
        $("#userlist").html(result);
    },
  });
 }
</script>
<div class="card mb-3">
  <div class="card-header">
    {% ifequal request.path user_list_inactive %}Inactive
      PhysioNet Users <span class="badge badge-pill badge-danger">{{ users|length }}</span>
    {% else %}
      PhysioNet Users <span class="badge badge-pill badge-info">{{ users|length }}</span>
    {% endifequal %}
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <input type="search" oninput="search(value);" placeholder="Search...">
      <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
        <thead>
          <tr>
            <th>Username</th>
            <th>Full Name</th>
            <th>Email</th>
            <th>Join Date</th>
            <th>Last Login</th>
            <th>Logins  {% if request.path != user_list_inactive %}(90 days){% else %}(total){% endif %}</th>
            <th>Credentialed</th>
          </tr>
        </thead>
        <tbody id="userlist">
          {% include 'console/users_list.html' %}
        </tbody>
      </table>
      {% if users.has_other_pages %}
        <div style="text-align: center;">
          <ul class="pagination">
            <li><a href="?{{ querystring }}page=1">&laquo;</a></li>
            {% if users.has_previous %}
              <li><a href="?{{ querystring }}page={{ users.previous_page_number }}">&lsaquo;</a></li>
            {% else %}
              <li class="disabled"><span>&lsaquo;</span></li>
            {% endif %}
            {% for i in i|ljust:10 %}
              {% with num=forloop.counter|add:users.number|add:"-4" %}
              {% if num > 0 and num <= users.paginator.num_pages %}
                {% if users.number == num %}
                  <li class="active"><span>{{ num }} <span class="sr-only">(current)</span></span></li>
                {% else %}
                  <li><a href="?{{ querystring }}page={{ num }}">{{ num }}</a></li>
                {% endif %}
              {% endif %}
              {% endwith %}
            {% endfor %}
            {% if users.has_next %}
              <li><a href="?{{ querystring }}page={{ users.next_page_number }}">&rsaquo;</a></li>
            {% else %}
              <li class="disabled"><span>&rsaquo;</span></li>
            {% endif %}
            <li><a href="?{{ querystring }}page={{ users.paginator.num_pages }}">&raquo;</a></li>
          </ul>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
