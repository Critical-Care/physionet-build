#!/bin/bash
destination=/physionet/physionet-build/
echo "Deploying into $destination"
GIT_WORK_TREE=$destination git checkout --force dev

echo "Updating content"
export DJANGO_SETTINGS_MODULE=physionet.settings.staging
cd $destination
source /physionet/python-env/physionet/bin/activate
sudo /bin/chgrp www-data /physionet/physionet-build/deploy
sudo /bin/chmod g+w /physionet/physionet-build/deploy
pip install -r requirements.txt
cd physionet-django
python manage.py collectstatic --noinput
python manage.py makemigrations
python manage.py migrate
touch physionet/wsgi.py

echo "Done"
